(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))d(h);new MutationObserver(h=>{for(const v of h)if(v.type==="childList")for(const S of v.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&d(S)}).observe(document,{childList:!0,subtree:!0});function l(h){const v={};return h.integrity&&(v.integrity=h.integrity),h.referrerPolicy&&(v.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?v.credentials="include":h.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function d(h){if(h.ep)return;h.ep=!0;const v=l(h);fetch(h.href,v)}})();var Se=1e-6,xt=typeof Float32Array<"u"?Float32Array:Array;function Ct(){var u=new xt(16);return xt!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u}function An(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function Pr(u,o,l){var d=o[0],h=o[1],v=o[2],S=o[3],g=o[4],A=o[5],B=o[6],E=o[7],_=o[8],F=o[9],R=o[10],W=o[11],$=o[12],z=o[13],q=o[14],tt=o[15],I=l[0],P=l[1],k=l[2],H=l[3];return u[0]=I*d+P*g+k*_+H*$,u[1]=I*h+P*A+k*F+H*z,u[2]=I*v+P*B+k*R+H*q,u[3]=I*S+P*E+k*W+H*tt,I=l[4],P=l[5],k=l[6],H=l[7],u[4]=I*d+P*g+k*_+H*$,u[5]=I*h+P*A+k*F+H*z,u[6]=I*v+P*B+k*R+H*q,u[7]=I*S+P*E+k*W+H*tt,I=l[8],P=l[9],k=l[10],H=l[11],u[8]=I*d+P*g+k*_+H*$,u[9]=I*h+P*A+k*F+H*z,u[10]=I*v+P*B+k*R+H*q,u[11]=I*S+P*E+k*W+H*tt,I=l[12],P=l[13],k=l[14],H=l[15],u[12]=I*d+P*g+k*_+H*$,u[13]=I*h+P*A+k*F+H*z,u[14]=I*v+P*B+k*R+H*q,u[15]=I*S+P*E+k*W+H*tt,u}function Br(u,o,l){var d=l[0],h=l[1],v=l[2],S,g,A,B,E,_,F,R,W,$,z,q;return o===u?(u[12]=o[0]*d+o[4]*h+o[8]*v+o[12],u[13]=o[1]*d+o[5]*h+o[9]*v+o[13],u[14]=o[2]*d+o[6]*h+o[10]*v+o[14],u[15]=o[3]*d+o[7]*h+o[11]*v+o[15]):(S=o[0],g=o[1],A=o[2],B=o[3],E=o[4],_=o[5],F=o[6],R=o[7],W=o[8],$=o[9],z=o[10],q=o[11],u[0]=S,u[1]=g,u[2]=A,u[3]=B,u[4]=E,u[5]=_,u[6]=F,u[7]=R,u[8]=W,u[9]=$,u[10]=z,u[11]=q,u[12]=S*d+E*h+W*v+o[12],u[13]=g*d+_*h+$*v+o[13],u[14]=A*d+F*h+z*v+o[14],u[15]=B*d+R*h+q*v+o[15]),u}function jn(u,o,l){var d=Math.sin(l),h=Math.cos(l),v=o[4],S=o[5],g=o[6],A=o[7],B=o[8],E=o[9],_=o[10],F=o[11];return o!==u&&(u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15]),u[4]=v*h+B*d,u[5]=S*h+E*d,u[6]=g*h+_*d,u[7]=A*h+F*d,u[8]=B*h-v*d,u[9]=E*h-S*d,u[10]=_*h-g*d,u[11]=F*h-A*d,u}function En(u,o,l){var d=Math.sin(l),h=Math.cos(l),v=o[0],S=o[1],g=o[2],A=o[3],B=o[8],E=o[9],_=o[10],F=o[11];return o!==u&&(u[4]=o[4],u[5]=o[5],u[6]=o[6],u[7]=o[7],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15]),u[0]=v*h-B*d,u[1]=S*h-E*d,u[2]=g*h-_*d,u[3]=A*h-F*d,u[8]=v*d+B*h,u[9]=S*d+E*h,u[10]=g*d+_*h,u[11]=A*d+F*h,u}function Mn(u,o,l,d,h){var v=1/Math.tan(o/2);if(u[0]=v/l,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=v,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,h!=null&&h!==1/0){var S=1/(d-h);u[10]=(h+d)*S,u[14]=2*h*d*S}else u[10]=-1,u[14]=-2*d;return u}var Pn=Mn;function Bn(u,o,l,d){var h,v,S,g,A,B,E,_,F,R,W=o[0],$=o[1],z=o[2],q=d[0],tt=d[1],I=d[2],P=l[0],k=l[1],H=l[2];return Math.abs(W-P)<Se&&Math.abs($-k)<Se&&Math.abs(z-H)<Se?An(u):(E=W-P,_=$-k,F=z-H,R=1/Math.sqrt(E*E+_*_+F*F),E*=R,_*=R,F*=R,h=tt*F-I*_,v=I*E-q*F,S=q*_-tt*E,R=Math.sqrt(h*h+v*v+S*S),R?(R=1/R,h*=R,v*=R,S*=R):(h=0,v=0,S=0),g=_*S-F*v,A=F*h-E*S,B=E*v-_*h,R=Math.sqrt(g*g+A*A+B*B),R?(R=1/R,g*=R,A*=R,B*=R):(g=0,A=0,B=0),u[0]=h,u[1]=g,u[2]=E,u[3]=0,u[4]=v,u[5]=A,u[6]=_,u[7]=0,u[8]=S,u[9]=B,u[10]=F,u[11]=0,u[12]=-(h*W+v*$+S*z),u[13]=-(g*W+A*$+B*z),u[14]=-(E*W+_*$+F*z),u[15]=1,u)}function On(){var u=new xt(3);return xt!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function be(u,o,l){var d=new xt(3);return d[0]=u,d[1]=o,d[2]=l,d}(function(){var u=On();return function(o,l,d,h,v,S){var g,A;for(l||(l=3),d||(d=0),h?A=Math.min(h*l+d,o.length):A=o.length,g=d;g<A;g+=l)u[0]=o[g],u[1]=o[g+1],u[2]=o[g+2],v(u,u,S),o[g]=u[0],o[g+1]=u[1],o[g+2]=u[2];return o}})();function Tr(){var u=new xt(4);return xt!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0,u[3]=0),u}function Cn(u,o,l,d){var h=new xt(4);return h[0]=u,h[1]=o,h[2]=l,h[3]=d,h}function Tn(u,o,l){var d=o[0],h=o[1],v=o[2],S=o[3];return u[0]=l[0]*d+l[4]*h+l[8]*v+l[12]*S,u[1]=l[1]*d+l[5]*h+l[9]*v+l[13]*S,u[2]=l[2]*d+l[6]*h+l[10]*v+l[14]*S,u[3]=l[3]*d+l[7]*h+l[11]*v+l[15]*S,u}(function(){var u=Tr();return function(o,l,d,h,v,S){var g,A;for(l||(l=4),d||(d=0),h?A=Math.min(h*l+d,o.length):A=o.length,g=d;g<A;g+=l)u[0]=o[g],u[1]=o[g+1],u[2]=o[g+2],u[3]=o[g+3],v(u,u,S),o[g]=u[0],o[g+1]=u[1],o[g+2]=u[2],o[g+3]=u[3];return o}})();const Un=`struct CameraUniforms {
  vpMatrix: mat4x4<f32>,
};

struct ShapeUniforms {
  modelMatrix: mat4x4<f32>,
  baseColor: vec3<f32>,
  threat: f32,
  targeted: f32,
};

@binding(0) @group(0) var<uniform> camera: CameraUniforms;
@binding(1) @group(0) var<uniform> shape: ShapeUniforms;

struct VertexInput {
  @location(0) position: vec3<f32>,
  @location(1) normal: vec3<f32>,
};

struct VertexOutput {
  @builtin(position) position: vec4<f32>,
  @location(0) normal: vec3<f32>,
  @location(1) color: vec3<f32>,
  @location(2) threat: f32,
  @location(3) targeted: f32,
};

@vertex
fn main(input: VertexInput) -> VertexOutput {
  var output: VertexOutput;
  let worldPos = shape.modelMatrix * vec4<f32>(input.position, 1.0);
  output.position = camera.vpMatrix * worldPos;
  let normalMatrix = mat3x3<f32>(
    shape.modelMatrix[0].xyz,
    shape.modelMatrix[1].xyz,
    shape.modelMatrix[2].xyz
  );
  output.normal = normalize(normalMatrix * input.normal);
  output.color = shape.baseColor;
  output.threat = shape.threat;
  output.targeted = shape.targeted;
  return output;
}`,Fn=`struct FragmentInput {
  @location(0) normal: vec3<f32>,
  @location(1) color: vec3<f32>,
  @location(2) threat: f32,
  @location(3) targeted: f32,
};

@fragment
fn main(input: FragmentInput) -> @location(0) vec4<f32> {
  let N = normalize(input.normal);
  let lightDir = normalize(vec3<f32>(0.5, 1.0, 0.8));
  let diffuse = max(dot(N, lightDir), 0.0) * 0.7 + 0.3;
  
  // Define the target color for high threat
  let highThreatColor = vec3<f32>(1.0, 0.0, 0.0); // Red
  
  // NEW: Blend from the shape's base color directly to red based on threat level
  var blendedColor = mix(input.color, highThreatColor, input.threat);
  
  // Highlight when targeted
  if (input.targeted > 0.5) {
    blendedColor += vec3<f32>(0.2, 0.3, 0.0);
  }
  
  // Apply standard lighting
  let litColor = blendedColor * diffuse;

  // Add a glow effect that intensifies with threat, using the high-threat color
  let glowIntensity = input.threat * input.threat * 0.4;
  let glowColor = highThreatColor * glowIntensity;
  
  var finalColor = litColor + glowColor;

  // Add a rapid blinking effect when critically close
  if (input.threat > 0.85) {
    let blinkSpeed = 25.0;
    // Use fract() to create a sharp on/off blink
    let blinkPhase = fract(input.threat * blinkSpeed);
    if (blinkPhase > 0.5) {
      // Make it much brighter during the "on" part of the blink
      finalColor += vec3<f32>(0.6, 0.6, 0.4);
    }
  }
  
  return vec4<f32>(finalColor, 1.0);
}`,Rn=`struct CameraUniforms {
  vpMatrix: mat4x4<f32>,
};

struct ParticleUniforms {
  modelMatrix: mat4x4<f32>,
  life: f32,
};

@binding(0) @group(0) var<uniform> camera: CameraUniforms;
@binding(1) @group(0) var<uniform> particle: ParticleUniforms;

struct VertexInput {
  @location(0) position: vec3<f32>,
  @location(1) color: vec3<f32>,
};

struct VertexOutput {
  @builtin(position) position: vec4<f32>,
  @location(0) color: vec3<f32>,
  @location(1) alpha: f32,
};

@vertex
fn main(input: VertexInput) -> VertexOutput {
  var output: VertexOutput;
  let worldPos = particle.modelMatrix * vec4<f32>(input.position, 1.0);
  output.position = camera.vpMatrix * worldPos;
  output.color = input.color;
  output.alpha = particle.life;
  return output;
}`,_n=`struct FragmentInput {
  @location(0) color: vec3<f32>,
  @location(1) alpha: f32,
};

@fragment
fn main(input: FragmentInput) -> @location(0) vec4<f32> {
  return vec4<f32>(input.color, input.alpha);
}`;class Ln{constructor(o){this.canvas=o,this.device=null,this.context=null,this.format=null,this.shapePipeline=null,this.particlePipeline=null,this.depthTexture=null,this.cameraUniformBuffer=null,this.genericBindGroupLayout=null,this.viewMatrix=Ct(),this.projectionMatrix=Ct()}async init(){if(!navigator.gpu)throw new Error("WebGPU not supported");this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight;const o=await navigator.gpu.requestAdapter();this.device=await o.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.format=navigator.gpu.getPreferredCanvasFormat(),this.context.configure({device:this.device,format:this.format,alphaMode:"premultiplied"}),this.createDepthTexture(),this.createUniformBuffers(),this.createPipelines(),Bn(this.viewMatrix,be(0,0,5),be(0,0,0),be(0,1,0)),window.addEventListener("resize",()=>this.handleResize())}createDepthTexture(){this.depthTexture=this.device.createTexture({size:[this.canvas.width,this.canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT})}createUniformBuffers(){this.cameraUniformBuffer=this.device.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}createPipelines(){this.genericBindGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]});const o=this.device.createPipelineLayout({bindGroupLayouts:[this.genericBindGroupLayout]});this.shapePipeline=this.device.createRenderPipeline({layout:o,vertex:{module:this.device.createShaderModule({code:Un}),entryPoint:"main",buffers:[{arrayStride:24,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:12,format:"float32x3"}]}]},fragment:{module:this.device.createShaderModule({code:Fn}),entryPoint:"main",targets:[{format:this.format}]},primitive:{topology:"triangle-list",cullMode:"back"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),this.particlePipeline=this.device.createRenderPipeline({layout:o,vertex:{module:this.device.createShaderModule({code:Rn}),entryPoint:"main",buffers:[{arrayStride:24,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:12,format:"float32x3"}]}]},fragment:{module:this.device.createShaderModule({code:_n}),entryPoint:"main",targets:[{format:this.format,blend:{color:{srcFactor:"src-alpha",dstFactor:"one",operation:"add"},alpha:{srcFactor:"src-alpha",dstFactor:"one",operation:"add"}}}]},primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus",depthWriteEnabled:!1,depthCompare:"less"}})}render({shapes:o,particles:l,targetedShape:d}){const h=this.canvas.width/this.canvas.height;Pn(this.projectionMatrix,60*Math.PI/180,h,.1,100);const v=Pr(Ct(),this.projectionMatrix,this.viewMatrix);this.device.queue.writeBuffer(this.cameraUniformBuffer,0,v);const S=this.device.createCommandEncoder(),g=this.context.getCurrentTexture().createView(),A=S.beginRenderPass({colorAttachments:[{view:g,loadOp:"clear",storeOp:"store",clearValue:{r:0,g:0,b:.05,a:1}}],depthStencilAttachment:{view:this.depthTexture.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});A.setPipeline(this.shapePipeline),o.filter(E=>E&&E.vertexBuffer&&E.indexBuffer&&!E.toBeRemoved).forEach(E=>this.renderShape(A,E,E===d)),l&&l.length>0&&(A.setPipeline(this.particlePipeline),l.forEach(E=>this.renderParticle(A,E))),A.end(),this.device.queue.submit([S.finish()])}renderShape(o,l,d){if(!l.vertexBuffer||!l.indexBuffer||!l.indexCount||!l.uniformBuffer||!l.bindGroup)return;const h=new Float32Array(24),v=Ct();Br(v,v,l.position),En(v,v,l.rotationY),jn(v,v,l.rotationX),h.set(v,0),h.set(l.color,16),h[20]=Math.max(0,Math.min(1,l.threat!==void 0?l.threat:0)),h[21]=d?1:0,this.device.queue.writeBuffer(l.uniformBuffer,0,h),o.setBindGroup(0,l.bindGroup),o.setVertexBuffer(0,l.vertexBuffer),o.setIndexBuffer(l.indexBuffer,"uint16"),o.drawIndexed(l.indexCount)}renderParticle(o,l){if(!l.vertexBuffer||!l.uniformBuffer||!l.bindGroup)return;const d=new Float32Array(20),h=Ct();Br(h,h,l.position),d.set(h,0),d[16]=l.life,this.device.queue.writeBuffer(l.uniformBuffer,0,d),o.setBindGroup(0,l.bindGroup),o.setVertexBuffer(0,l.vertexBuffer),o.draw(6)}projectToScreen(o){const l=Pr(Ct(),this.projectionMatrix,this.viewMatrix),d=Tn(Tr(),Cn(o[0],o[1],o[2],1),l);if(d[3]<=0)return null;const h=d[0]/d[3],v=d[1]/d[3];return{x:(h+1)*.5*this.canvas.width,y:(1-v)*.5*this.canvas.height}}handleResize(){this.device&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.depthTexture.destroy(),this.createDepthTexture(),this.context.configure({device:this.device,format:this.format,alphaMode:"premultiplied"}))}destroy(){this.depthTexture?.destroy(),this.cameraUniformBuffer?.destroy()}}class In{constructor(){this.score=0,this.wave=1,this.isGameOver=!1,this.shapesDestroyed=0}reset(){this.score=0,this.wave=1,this.isGameOver=!1,this.shapesDestroyed=0}addScore(o){this.score+=o,this.shapesDestroyed++,this.shapesDestroyed>0&&this.shapesDestroyed%10===0&&this.wave++}}class Dn{constructor(o){this.renderer=o,this.device=o.device,this.canvas=o.canvas,this.shapes=[],this.spawnTimer=0,this.shapeTypes=["cube","sphere","torus","pyramid"]}reset(){this.shapes.forEach(o=>{o.vertexBuffer?.destroy(),o.indexBuffer?.destroy(),o.uniformBuffer?.destroy()}),this.shapes=[],this.spawnTimer=0}update(o,l){this.spawnTimer+=o;const d=Math.max(.4,2-l*.02);this.spawnTimer>=d&&(this.spawnTimer=0,this.spawnRandomShape(l));for(let h=this.shapes.length-1;h>=0;h--)if(this.shapes[h].toBeRemoved){const v=this.shapes[h];v.vertexBuffer?.destroy(),v.indexBuffer?.destroy(),v.uniformBuffer?.destroy(),this.shapes.splice(h,1)}}spawnRandomShape(o){const l=this.shapeTypes[Math.floor(Math.random()*this.shapeTypes.length)],d=-10,h=this.canvas.width/this.canvas.height,v=60*Math.PI/180,S=2*Math.tan(v/2)*Math.abs(d),g=S*h,A=.5,B=g-A*2,E=S-A*2;let _=(Math.random()-.5)*B,F=(Math.random()-.5)*E;const R=4.5,W=2*Math.tan(v/2)*Math.abs(R),$=W*h,z=(Math.random()-.5)*$,q=(Math.random()-.5)*W,tt=z-_,I=q-F,P=R-d,k=Math.sqrt(tt*tt+I*I+P*P),H=tt/k,ht=I/k,J=P/k,st=2+o*.03,p=[H*st,ht*st,J*st],m={type:l,position:[_,F,d],rotationX:0,rotationY:0,velocity:p,color:this.getShapeColor(l),toBeRemoved:!1};this.createShapeGeometry(m),this.shapes.push(m)}getShapeColor(o){switch(o){case"cube":return[.2,.6,1];case"sphere":return[1,.5,.2];case"torus":return[.8,.2,1];case"pyramid":return[.2,1,.5];default:return[1,1,1]}}createShapeGeometry(o){let l={vertices:[],indices:[]};switch(o.type){case"cube":l=this.createCube();break;case"sphere":l=this.createSphere();break;case"torus":l=this.createTorus();break;case"pyramid":l=this.createPyramid();break}const{vertices:d,indices:h}=l,v=new Float32Array(d),S=new Uint16Array(h);o.vertexBuffer=this.device.createBuffer({size:v.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),this.device.queue.writeBuffer(o.vertexBuffer,0,v),o.indexBuffer=this.device.createBuffer({size:S.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST}),this.device.queue.writeBuffer(o.indexBuffer,0,S),o.indexCount=h.length,o.uniformBuffer=this.device.createBuffer({size:96,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),o.bindGroup=this.device.createBindGroup({layout:this.renderer.genericBindGroupLayout,entries:[{binding:0,resource:{buffer:this.renderer.cameraUniformBuffer}},{binding:1,resource:{buffer:o.uniformBuffer}}]})}createCube(){return{vertices:[-.5,-.5,.5,0,0,1,.5,-.5,.5,0,0,1,.5,.5,.5,0,0,1,-.5,.5,.5,0,0,1,-.5,-.5,-.5,0,0,-1,-.5,.5,-.5,0,0,-1,.5,.5,-.5,0,0,-1,.5,-.5,-.5,0,0,-1,-.5,.5,-.5,0,1,0,-.5,.5,.5,0,1,0,.5,.5,.5,0,1,0,.5,.5,-.5,0,1,0,-.5,-.5,-.5,0,-1,0,.5,-.5,-.5,0,-1,0,.5,-.5,.5,0,-1,0,-.5,-.5,.5,0,-1,0,.5,-.5,-.5,1,0,0,.5,.5,-.5,1,0,0,.5,.5,.5,1,0,0,.5,-.5,.5,1,0,0,-.5,-.5,-.5,-1,0,0,-.5,-.5,.5,-1,0,0,-.5,.5,.5,-1,0,0,-.5,.5,-.5,-1,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}}createPyramid(){const d=Math.sqrt(.5),h=.5/d,v=.5/d;return{vertices:[-.5,-.5,-.5,0,-1,0,.5,-.5,-.5,0,-1,0,.5,-.5,.5,0,-1,0,-.5,-.5,.5,0,-1,0,0,.5,0,0,v,h,-.5,-.5,.5,0,v,h,.5,-.5,.5,0,v,h,0,.5,0,0,v,-h,.5,-.5,-.5,0,v,-h,-.5,-.5,-.5,0,v,-h,0,.5,0,h,v,0,.5,-.5,.5,h,v,0,.5,-.5,-.5,h,v,0,0,.5,0,-h,v,0,-.5,-.5,-.5,-h,v,0,-.5,-.5,.5,-h,v,0],indices:[0,1,2,0,2,3,4,5,6,7,8,9,10,11,12,13,14,15]}}createSphere(){const o=[],l=[];for(let S=0;S<=12;S++){const g=S*Math.PI/12;for(let A=0;A<=16;A++){const B=A*2*Math.PI/16,E=-.5*Math.cos(B)*Math.sin(g),_=.5*Math.cos(g),F=.5*Math.sin(B)*Math.sin(g);o.push(E,_,F,E,_,F)}}for(let S=0;S<12;S++)for(let g=0;g<16;g++){const A=S*17+g,B=A+16+1;l.push(A,B,A+1,B,B+1,A+1)}return{vertices:o,indices:l}}createTorus(){const o=[],l=[];for(let g=0;g<=20;g++)for(let A=0;A<=12;A++){const B=A/12*Math.PI*2,E=g/20*Math.PI*2,_=(.4+.15*Math.cos(B))*Math.cos(E),F=.15*Math.sin(B),R=(.4+.15*Math.cos(B))*Math.sin(E),W=Math.cos(B)*Math.cos(E),$=Math.sin(B),z=Math.cos(B)*Math.sin(E);o.push(_,F,R,W,$,z)}for(let g=0;g<20;g++)for(let A=0;A<12;A++){const B=13*g+A,E=B+12+1;l.push(B,E,B+1,E,E+1,B+1)}return{vertices:o,indices:l}}getShapes(){return this.shapes}}var Jt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ae={},Or;function Gn(){return Or||(Or=1,(function(){var u;function o(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var l=typeof Object.defineProperties=="function"?Object.defineProperty:function(t,e,r){return t==Array.prototype||t==Object.prototype||(t[e]=r.value),t};function d(t){t=[typeof globalThis=="object"&&globalThis,t,typeof window=="object"&&window,typeof self=="object"&&self,typeof Jt=="object"&&Jt];for(var e=0;e<t.length;++e){var r=t[e];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}var h=d(this);function v(t,e){if(e)t:{var r=h;t=t.split(".");for(var n=0;n<t.length-1;n++){var i=t[n];if(!(i in r))break t;r=r[i]}t=t[t.length-1],n=r[t],e=e(n),e!=n&&e!=null&&l(r,t,{configurable:!0,writable:!0,value:e})}}v("Symbol",function(t){function e(a){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new r(n+(a||"")+"_"+i++,a)}function r(a,s){this.h=a,l(this,"description",{configurable:!0,writable:!0,value:s})}if(t)return t;r.prototype.toString=function(){return this.h};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return e}),v("Symbol.iterator",function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var e="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<e.length;r++){var n=h[e[r]];typeof n=="function"&&typeof n.prototype[t]!="function"&&l(n.prototype,t,{configurable:!0,writable:!0,value:function(){return S(o(this))}})}return t});function S(t){return t={next:t},t[Symbol.iterator]=function(){return this},t}function g(t){var e=typeof Symbol<"u"&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:o(t)}}function A(t){if(!(t instanceof Array)){t=g(t);for(var e,r=[];!(e=t.next()).done;)r.push(e.value);t=r}return t}var B=typeof Object.assign=="function"?Object.assign:function(t,e){for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};v("Object.assign",function(t){return t||B});var E=typeof Object.create=="function"?Object.create:function(t){function e(){}return e.prototype=t,new e},_;if(typeof Object.setPrototypeOf=="function")_=Object.setPrototypeOf;else{var F;t:{var R={a:!0},W={};try{W.__proto__=R,F=W.a;break t}catch{}F=!1}_=F?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var $=_;function z(t,e){if(t.prototype=E(e.prototype),t.prototype.constructor=t,$)$(t,e);else for(var r in e)if(r!="prototype")if(Object.defineProperties){var n=Object.getOwnPropertyDescriptor(e,r);n&&Object.defineProperty(t,r,n)}else t[r]=e[r];t.ya=e.prototype}function q(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function tt(t){if(t.m)throw new TypeError("Generator is already running");t.m=!0}q.prototype.u=function(t){this.i=t};function I(t,e){t.l={ma:e,na:!0},t.h=t.s||t.v}q.prototype.return=function(t){this.l={return:t},this.h=this.v};function P(t,e,r){return t.h=r,{value:e}}function k(t){this.h=new q,this.i=t}function H(t,e){tt(t.h);var r=t.h.j;return r?ht(t,"return"in r?r.return:function(n){return{value:n,done:!0}},e,t.h.return):(t.h.return(e),J(t))}function ht(t,e,r,n){try{var i=e.call(t.h.j,r);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return t.h.m=!1,i;var a=i.value}catch(s){return t.h.j=null,I(t.h,s),J(t)}return t.h.j=null,n.call(t.h,a),J(t)}function J(t){for(;t.h.h;)try{var e=t.i(t.h);if(e)return t.h.m=!1,{value:e.value,done:!1}}catch(r){t.h.i=void 0,I(t.h,r)}if(t.h.m=!1,t.h.l){if(e=t.h.l,t.h.l=null,e.na)throw e.ma;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function st(t){this.next=function(e){return tt(t.h),t.h.j?e=ht(t,t.h.j.next,e,t.h.u):(t.h.u(e),e=J(t)),e},this.throw=function(e){return tt(t.h),t.h.j?e=ht(t,t.h.j.throw,e,t.h.u):(I(t.h,e),e=J(t)),e},this.return=function(e){return H(t,e)},this[Symbol.iterator]=function(){return this}}function p(t){function e(n){return t.next(n)}function r(n){return t.throw(n)}return new Promise(function(n,i){function a(s){s.done?n(s.value):Promise.resolve(s.value).then(e,r).then(a,i)}a(t.next())})}function m(t){return p(new st(new k(t)))}v("Promise",function(t){function e(s){this.i=0,this.j=void 0,this.h=[],this.u=!1;var c=this.l();try{s(c.resolve,c.reject)}catch(f){c.reject(f)}}function r(){this.h=null}function n(s){return s instanceof e?s:new e(function(c){c(s)})}if(t)return t;r.prototype.i=function(s){if(this.h==null){this.h=[];var c=this;this.j(function(){c.m()})}this.h.push(s)};var i=h.setTimeout;r.prototype.j=function(s){i(s,0)},r.prototype.m=function(){for(;this.h&&this.h.length;){var s=this.h;this.h=[];for(var c=0;c<s.length;++c){var f=s[c];s[c]=null;try{f()}catch(y){this.l(y)}}}this.h=null},r.prototype.l=function(s){this.j(function(){throw s})},e.prototype.l=function(){function s(y){return function(x){f||(f=!0,y.call(c,x))}}var c=this,f=!1;return{resolve:s(this.I),reject:s(this.m)}},e.prototype.I=function(s){if(s===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(s instanceof e)this.L(s);else{t:switch(typeof s){case"object":var c=s!=null;break t;case"function":c=!0;break t;default:c=!1}c?this.F(s):this.s(s)}},e.prototype.F=function(s){var c=void 0;try{c=s.then}catch(f){this.m(f);return}typeof c=="function"?this.M(c,s):this.s(s)},e.prototype.m=function(s){this.v(2,s)},e.prototype.s=function(s){this.v(1,s)},e.prototype.v=function(s,c){if(this.i!=0)throw Error("Cannot settle("+s+", "+c+"): Promise already settled in state"+this.i);this.i=s,this.j=c,this.i===2&&this.K(),this.H()},e.prototype.K=function(){var s=this;i(function(){if(s.D()){var c=h.console;typeof c<"u"&&c.error(s.j)}},1)},e.prototype.D=function(){if(this.u)return!1;var s=h.CustomEvent,c=h.Event,f=h.dispatchEvent;return typeof f>"u"?!0:(typeof s=="function"?s=new s("unhandledrejection",{cancelable:!0}):typeof c=="function"?s=new c("unhandledrejection",{cancelable:!0}):(s=h.document.createEvent("CustomEvent"),s.initCustomEvent("unhandledrejection",!1,!0,s)),s.promise=this,s.reason=this.j,f(s))},e.prototype.H=function(){if(this.h!=null){for(var s=0;s<this.h.length;++s)a.i(this.h[s]);this.h=null}};var a=new r;return e.prototype.L=function(s){var c=this.l();s.T(c.resolve,c.reject)},e.prototype.M=function(s,c){var f=this.l();try{s.call(c,f.resolve,f.reject)}catch(y){f.reject(y)}},e.prototype.then=function(s,c){function f(j,b){return typeof j=="function"?function(T){try{y(j(T))}catch(L){x(L)}}:b}var y,x,C=new e(function(j,b){y=j,x=b});return this.T(f(s,y),f(c,x)),C},e.prototype.catch=function(s){return this.then(void 0,s)},e.prototype.T=function(s,c){function f(){switch(y.i){case 1:s(y.j);break;case 2:c(y.j);break;default:throw Error("Unexpected state: "+y.i)}}var y=this;this.h==null?a.i(f):this.h.push(f),this.u=!0},e.resolve=n,e.reject=function(s){return new e(function(c,f){f(s)})},e.race=function(s){return new e(function(c,f){for(var y=g(s),x=y.next();!x.done;x=y.next())n(x.value).T(c,f)})},e.all=function(s){var c=g(s),f=c.next();return f.done?n([]):new e(function(y,x){function C(T){return function(L){j[T]=L,b--,b==0&&y(j)}}var j=[],b=0;do j.push(void 0),b++,n(f.value).T(C(j.length-1),x),f=c.next();while(!f.done)})},e});function U(t,e){t instanceof String&&(t+="");var r=0,n=!1,i={next:function(){if(!n&&r<t.length){var a=r++;return{value:e(a,t[a]),done:!1}}return n=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}v("Array.prototype.keys",function(t){return t||function(){return U(this,function(e){return e})}}),v("Array.prototype.fill",function(t){return t||function(e,r,n){var i=this.length||0;for(0>r&&(r=Math.max(0,i+r)),(n==null||n>i)&&(n=i),n=Number(n),0>n&&(n=Math.max(0,i+n)),r=Number(r||0);r<n;r++)this[r]=e;return this}});function M(t){return t||Array.prototype.fill}v("Int8Array.prototype.fill",M),v("Uint8Array.prototype.fill",M),v("Uint8ClampedArray.prototype.fill",M),v("Int16Array.prototype.fill",M),v("Uint16Array.prototype.fill",M),v("Int32Array.prototype.fill",M),v("Uint32Array.prototype.fill",M),v("Float32Array.prototype.fill",M),v("Float64Array.prototype.fill",M),v("Object.is",function(t){return t||function(e,r){return e===r?e!==0||1/e===1/r:e!==e&&r!==r}}),v("Array.prototype.includes",function(t){return t||function(e,r){var n=this;n instanceof String&&(n=String(n));var i=n.length;for(r=r||0,0>r&&(r=Math.max(r+i,0));r<i;r++){var a=n[r];if(a===e||Object.is(a,e))return!0}return!1}}),v("String.prototype.includes",function(t){return t||function(e,r){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(e,r||0)!==-1}});var N=this||self;function Z(t,e){t=t.split(".");var r=N;t[0]in r||typeof r.execScript>"u"||r.execScript("var "+t[0]);for(var n;t.length&&(n=t.shift());)t.length||e===void 0?r[n]&&r[n]!==Object.prototype[n]?r=r[n]:r=r[n]={}:r[n]=e}function w(t){var e;t:{if((e=N.navigator)&&(e=e.userAgent))break t;e=""}return e.indexOf(t)!=-1}var O=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var r=t.length,n=Array(r),i=typeof t=="string"?t.split(""):t,a=0;a<r;a++)a in i&&(n[a]=e.call(void 0,i[a],a,t));return n},D={},X=null;function at(t){var e=t.length,r=3*e/4;r%3?r=Math.floor(r):"=.".indexOf(t[e-1])!=-1&&(r="=.".indexOf(t[e-2])!=-1?r-2:r-1);var n=new Uint8Array(r),i=0;return Tt(t,function(a){n[i++]=a}),i!==r?n.subarray(0,i):n}function Tt(t,e){function r(f){for(;n<t.length;){var y=t.charAt(n++),x=X[y];if(x!=null)return x;if(!/^[\s\xa0]*$/.test(y))throw Error("Unknown base64 encoding at char: "+y)}return f}ut();for(var n=0;;){var i=r(-1),a=r(0),s=r(64),c=r(64);if(c===64&&i===-1)break;e(i<<2|a>>4),s!=64&&(e(a<<4&240|s>>2),c!=64&&e(s<<6&192|c))}}function ut(){if(!X){X={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],r=0;5>r;r++){var n=t.concat(e[r].split(""));D[r]=n;for(var i=0;i<n.length;i++){var a=n[i];X[a]===void 0&&(X[a]=i)}}}}var lt=typeof Uint8Array<"u",Et=!(w("Trident")||w("MSIE"))&&typeof N.btoa=="function";function Mt(t){if(!Et){var e;e===void 0&&(e=0),ut(),e=D[e];for(var r=Array(Math.floor(t.length/3)),n=e[64]||"",i=0,a=0;i<t.length-2;i+=3){var s=t[i],c=t[i+1],f=t[i+2],y=e[s>>2];s=e[(s&3)<<4|c>>4],c=e[(c&15)<<2|f>>6],f=e[f&63],r[a++]=y+s+c+f}switch(y=0,f=n,t.length-i){case 2:y=t[i+1],f=e[(y&15)<<2]||n;case 1:t=t[i],r[a]=e[t>>2]+e[(t&3)<<4|y>>4]+f+n}return r.join("")}for(e="";10240<t.length;)e+=String.fromCharCode.apply(null,t.subarray(0,10240)),t=t.subarray(10240);return e+=String.fromCharCode.apply(null,t),btoa(e)}var Ee=RegExp("[-_.]","g");function Ur(t){switch(t){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function Me(t){if(!Et)return at(t);Ee.test(t)&&(t=t.replace(Ee,Ur)),t=atob(t);for(var e=new Uint8Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}var Pe;function te(){return Pe||(Pe=new Uint8Array(0))}var Ut={},Fr=typeof Uint8Array.prototype.slice=="function",Q=0,nt=0;function Be(t){var e=0>t;t=Math.abs(t);var r=t>>>0;t=Math.floor((t-r)/4294967296),e&&(r=g(Oe(r,t)),e=r.next().value,t=r.next().value,r=e),Q=r>>>0,nt=t>>>0}var Rr=typeof BigInt=="function";function Oe(t,e){return e=~e,t?t=~t+1:e+=1,[t,e]}function Ce(t,e){this.i=t>>>0,this.h=e>>>0}function Te(t){if(!t)return Ue||(Ue=new Ce(0,0));if(!/^-?\d+$/.test(t))return null;if(16>t.length)Be(Number(t));else if(Rr)t=BigInt(t),Q=Number(t&BigInt(4294967295))>>>0,nt=Number(t>>BigInt(32)&BigInt(4294967295));else{var e=+(t[0]==="-");nt=Q=0;for(var r=t.length,n=e,i=(r-e)%6+e;i<=r;n=i,i+=6)n=Number(t.slice(n,i)),nt*=1e6,Q=1e6*Q+n,4294967296<=Q&&(nt+=Q/4294967296|0,Q%=4294967296);e&&(e=g(Oe(Q,nt)),t=e.next().value,e=e.next().value,Q=t,nt=e)}return new Ce(Q,nt)}var Ue;function Fe(t,e){return Error("Invalid wire type: "+t+" (at position "+e+")")}function ee(){return Error("Failed to read varint, encoding is invalid.")}function Re(t,e){return Error("Tried to read past the end of the data "+e+" > "+t)}function St(){throw Error("Invalid UTF8")}function _e(t,e){return e=String.fromCharCode.apply(null,e),t==null?e:t+e}var kt=void 0,re,_r=typeof TextDecoder<"u",Le,Lr=typeof TextEncoder<"u",Ie;function De(t){if(t!==Ut)throw Error("illegal external caller")}function Ft(t,e){if(De(e),this.V=t,t!=null&&t.length===0)throw Error("ByteString should be constructed with non-empty values")}function ne(){return Ie||(Ie=new Ft(null,Ut))}function Ge(t){De(Ut);var e=t.V;return e=e==null||lt&&e!=null&&e instanceof Uint8Array?e:typeof e=="string"?Me(e):null,e==null?e:t.V=e}function Ir(t){if(typeof t=="string")return{buffer:Me(t),C:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),C:!1};if(t.constructor===Uint8Array)return{buffer:t,C:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),C:!1};if(t.constructor===Ft)return{buffer:Ge(t)||te(),C:!0};if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function ke(t,e){this.i=null,this.m=!1,this.h=this.j=this.l=0,ie(this,t,e)}function ie(t,e,r){r=r===void 0?{}:r,t.S=r.S===void 0?!1:r.S,e&&(e=Ir(e),t.i=e.buffer,t.m=e.C,t.l=0,t.j=t.i.length,t.h=t.l)}ke.prototype.reset=function(){this.h=this.l};function bt(t,e){if(t.h=e,e>t.j)throw Re(t.j,e)}function Rt(t){var e=t.i,r=t.h,n=e[r++],i=n&127;if(n&128&&(n=e[r++],i|=(n&127)<<7,n&128&&(n=e[r++],i|=(n&127)<<14,n&128&&(n=e[r++],i|=(n&127)<<21,n&128&&(n=e[r++],i|=n<<28,n&128&&e[r++]&128&&e[r++]&128&&e[r++]&128&&e[r++]&128&&e[r++]&128)))))throw ee();return bt(t,r),i}function Ne(t,e){if(0>e)throw Error("Tried to read a negative byte length: "+e);var r=t.h,n=r+e;if(n>t.j)throw Re(e,t.j-r);return t.h=n,r}var He=[];function oe(){this.h=[]}oe.prototype.length=function(){return this.h.length},oe.prototype.end=function(){var t=this.h;return this.h=[],t};function ze(t,e,r){for(;0<r||127<e;)t.h.push(e&127|128),e=(e>>>7|r<<25)>>>0,r>>>=7;t.h.push(e)}function At(t,e){for(;127<e;)t.h.push(e&127|128),e>>>=7;t.h.push(e)}function se(t,e){if(He.length){var r=He.pop();ie(r,t,e),t=r}else t=new ke(t,e);this.h=t,this.j=this.h.h,this.i=this.l=-1,this.setOptions(e)}se.prototype.setOptions=function(t){t=t===void 0?{}:t,this.ca=t.ca===void 0?!1:t.ca},se.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function Ve(t){var e=t.h;if(e.h==e.j)return!1;t.j=t.h.h;var r=Rt(t.h)>>>0;if(e=r>>>3,r&=7,!(0<=r&&5>=r))throw Fe(r,t.j);if(1>e)throw Error("Invalid field number: "+e+" (at position "+t.j+")");return t.l=e,t.i=r,!0}function Nt(t){switch(t.i){case 0:if(t.i!=0)Nt(t);else t:{t=t.h;for(var e=t.h,r=e+10,n=t.i;e<r;)if((n[e++]&128)===0){bt(t,e);break t}throw ee()}break;case 1:t=t.h,bt(t,t.h+8);break;case 2:t.i!=2?Nt(t):(e=Rt(t.h)>>>0,t=t.h,bt(t,t.h+e));break;case 5:t=t.h,bt(t,t.h+4);break;case 3:e=t.l;do{if(!Ve(t))throw Error("Unmatched start-group tag: stream EOF");if(t.i==4){if(t.l!=e)throw Error("Unmatched end-group tag");break}Nt(t)}while(!0);break;default:throw Fe(t.i,t.j)}}var Ht=[];function Dr(){this.j=[],this.i=0,this.h=new oe}function Pt(t,e){e.length!==0&&(t.j.push(e),t.i+=e.length)}function Gr(t,e){if(e=e.R){Pt(t,t.h.end());for(var r=0;r<e.length;r++)Pt(t,Ge(e[r])||te())}}var gt=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function jt(t,e){return gt?t[gt]|=e:t.A!==void 0?t.A|=e:(Object.defineProperties(t,{A:{value:e,configurable:!0,writable:!0,enumerable:!1}}),e)}function We(t,e){gt?t[gt]&&(t[gt]&=~e):t.A!==void 0&&(t.A&=~e)}function K(t){var e;return gt?e=t[gt]:e=t.A,e??0}function pt(t,e){gt?t[gt]=e:t.A!==void 0?t.A=e:Object.defineProperties(t,{A:{value:e,configurable:!0,writable:!0,enumerable:!1}})}function ae(t){return jt(t,1),t}function kr(t,e){pt(e,(t|0)&-51)}function zt(t,e){pt(e,(t|18)&-41)}var ue={};function Vt(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&t.constructor===Object}var _t,Xe=[];pt(Xe,23),_t=Object.freeze(Xe);function ce(t){if(K(t.o)&2)throw Error("Cannot mutate an immutable Message")}function he(t){var e=t.length;(e=e?t[e-1]:void 0)&&Vt(e)?e.g=1:(e={},t.push((e.g=1,e)))}function Ye(t){var e=t.i+t.G;return t.B||(t.B=t.o[e]={})}function ft(t,e){return e===-1?null:e>=t.i?t.B?t.B[e]:void 0:t.o[e+t.G]}function vt(t,e,r,n){ce(t),Lt(t,e,r,n)}function Lt(t,e,r,n){t.j&&(t.j=void 0),e>=t.i||n?Ye(t)[e]=r:(t.o[e+t.G]=r,(t=t.B)&&e in t&&delete t[e])}function le(t,e,r,n){var i=ft(t,e);Array.isArray(i)||(i=_t);var a=K(i);if(a&1||ae(i),n)a&2||jt(i,2),r&1||Object.freeze(i);else{n=!(r&2);var s=a&2;r&1||!s?n&&a&16&&!s&&We(i,16):(i=ae(Array.prototype.slice.call(i)),Lt(t,e,i))}return i}function fe(t,e){var r=ft(t,e),n=r==null?r:typeof r=="number"||r==="NaN"||r==="Infinity"||r==="-Infinity"?Number(r):void 0;return n!=null&&n!==r&&Lt(t,e,n),n}function $e(t,e,r,n,i){t.h||(t.h={});var a=t.h[r],s=le(t,r,3,i);if(!a){var c=s;a=[];var f=!!(K(t.o)&16);s=!!(K(c)&2);var y=c;!i&&s&&(c=Array.prototype.slice.call(c));for(var x=s,C=0;C<c.length;C++){var j=c[C],b=e,T=!1;if(T=T===void 0?!1:T,j=Array.isArray(j)?new b(j):T?new b:void 0,j!==void 0){b=j.o;var L=T=K(b);s&&(L|=2),f&&(L|=16),L!=T&&pt(b,L),b=L,x=x||!!(2&b),a.push(j)}}return t.h[r]=a,f=K(c),e=f|33,e=x?e&-9:e|8,f!=e&&(x=c,Object.isFrozen(x)&&(x=Array.prototype.slice.call(x)),pt(x,e),c=x),y!==c&&Lt(t,r,c),(i||n&&s)&&jt(a,2),n&&Object.freeze(a),a}return i||(i=Object.isFrozen(a),n&&!i?Object.freeze(a):!n&&i&&(a=Array.prototype.slice.call(a),t.h[r]=a)),a}function Wt(t,e,r){var n=!!(K(t.o)&2);if(e=$e(t,e,r,n,n),t=le(t,r,3,n),!(n||K(t)&8)){for(n=0;n<e.length;n++){if(r=e[n],K(r.o)&2){var i=tr(r,!1);i.j=r}else i=r;r!==i&&(e[n]=i,t[n]=i.o)}jt(t,8)}return e}function mt(t,e,r){if(r!=null&&typeof r!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof r+": "+r);vt(t,e,r)}function Ke(t,e,r,n,i){ce(t);var a=$e(t,r,e,!1,!1);return r=n??new r,t=le(t,e,2,!1),i!=null?(a.splice(i,0,r),t.splice(i,0,r.o)):(a.push(r),t.push(r.o)),r.C()&&We(t,8),r}function Xt(t,e){return t??e}function yt(t,e,r){return r=r===void 0?0:r,Xt(fe(t,e),r)}var Yt;function Nr(t){switch(typeof t){case"number":return isFinite(t)?t:String(t);case"object":if(t)if(Array.isArray(t)){if((K(t)&128)!==0)return t=Array.prototype.slice.call(t),he(t),t}else{if(lt&&t!=null&&t instanceof Uint8Array)return Mt(t);if(t instanceof Ft){var e=t.V;return e==null?"":typeof e=="string"?e:t.V=Mt(e)}}}return t}function Ze(t,e,r,n){if(t!=null){if(Array.isArray(t))t=de(t,e,r,n!==void 0);else if(Vt(t)){var i={},a;for(a in t)i[a]=Ze(t[a],e,r,n);t=i}else t=e(t,n);return t}}function de(t,e,r,n){var i=K(t);n=n?!!(i&16):void 0,t=Array.prototype.slice.call(t);for(var a=0;a<t.length;a++)t[a]=Ze(t[a],e,r,n);return r(i,t),t}function Hr(t){return t.ja===ue?t.toJSON():Nr(t)}function zr(t,e){t&128&&he(e)}function qe(t,e,r){if(r=r===void 0?zt:r,t!=null){if(lt&&t instanceof Uint8Array)return t.length?new Ft(new Uint8Array(t),Ut):ne();if(Array.isArray(t)){var n=K(t);return n&2?t:e&&!(n&32)&&(n&16||n===0)?(pt(t,n|2),t):(t=de(t,qe,n&4?zt:r,!0),e=K(t),e&4&&e&2&&Object.freeze(t),t)}return t.ja===ue?Je(t):t}}function Qe(t,e,r,n,i,a,s){if(t=t.h&&t.h[r]){if(n=K(t),n&2?n=t:(a=O(t,Je),zt(n,a),Object.freeze(a),n=a),ce(e),s=n==null?_t:ae([]),n!=null){for(a=!!n.length,t=0;t<n.length;t++){var c=n[t];a=a&&!(K(c.o)&2),s[t]=c.o}a=(a?8:0)|1,t=K(s),(t&a)!==a&&(Object.isFrozen(s)&&(s=Array.prototype.slice.call(s)),pt(s,t|a)),e.h||(e.h={}),e.h[r]=n}else e.h&&(e.h[r]=void 0);Lt(e,r,s,i)}else vt(e,r,qe(n,a,s),i)}function Je(t){return K(t.o)&2||(t=tr(t,!0),jt(t.o,2)),t}function tr(t,e){var r=t.o,n=[];jt(n,16);var i=t.constructor.h;if(i&&n.push(i),i=t.B,i){n.length=r.length,n.fill(void 0,n.length,r.length);var a={};n[n.length-1]=a}(K(r)&128)!==0&&he(n),e=e||t.C()?zt:kr,a=t.constructor,Yt=n,n=new a(n),Yt=void 0,t.R&&(n.R=t.R.slice()),a=!!(K(r)&16);for(var s=i?r.length-1:r.length,c=0;c<s;c++)Qe(t,n,c-t.G,r[c],!1,a,e);if(i)for(var f in i)Qe(t,n,+f,i[f],!0,a,e);return n}function it(t,e,r){t==null&&(t=Yt),Yt=void 0;var n=this.constructor.i||0,i=0<n,a=this.constructor.h,s=!1;if(t==null){t=a?[a]:[];var c=48,f=!0;i&&(n=0,c|=128),pt(t,c)}else{if(!Array.isArray(t)||a&&a!==t[0])throw Error();var y=c=jt(t,0);if((f=(16&y)!==0)&&((s=(32&y)!==0)||(y|=32)),i){if(128&y)n=0;else if(0<t.length){var x=t[t.length-1];if(Vt(x)&&"g"in x){n=0,y|=128,delete x.g;var C=!0,j;for(j in x){C=!1;break}C&&t.pop()}}}else if(128&y)throw Error();c!==y&&pt(t,y)}this.G=(a?0:-1)-n,this.h=void 0,this.o=t;t:{if(a=this.o.length,n=a-1,a&&(a=this.o[n],Vt(a))){this.B=a,this.i=n-this.G;break t}e!==void 0&&-1<e?(this.i=Math.max(e,n+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!i&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(r){e=f&&!s&&!0,i=this.i;var b;for(f=0;f<r.length;f++)s=r[f],s<i?(s+=this.G,(n=t[s])?er(n,e):t[s]=_t):(b||(b=Ye(this)),(n=b[s])?er(n,e):b[s]=_t)}}it.prototype.toJSON=function(){return de(this.o,Hr,zr)},it.prototype.C=function(){return!!(K(this.o)&2)};function er(t,e){if(Array.isArray(t)){var r=K(t),n=1;!e||r&2||(n|=16),(r&n)!==n&&pt(t,r|n)}}it.prototype.ja=ue,it.prototype.toString=function(){return this.o.toString()};function rr(t,e,r){if(r){var n={},i;for(i in r){var a=r[i],s=a.qa;s||(n.J=a.wa||a.oa.W,a.ia?(n.aa=ar(a.ia),s=(function(c){return function(f,y,x){return c.J(f,y,x,c.aa)}})(n)):a.ka?(n.Z=ur(a.da.P,a.ka),s=(function(c){return function(f,y,x){return c.J(f,y,x,c.Z)}})(n)):s=n.J,a.qa=s),s(e,t,a.da),n={J:n.J,aa:n.aa,Z:n.Z}}}Gr(e,t)}var $t=Symbol();function nr(t,e,r){return t[$t]||(t[$t]=function(n,i){return e(n,i,r)})}function ir(t){var e=t[$t];if(!e){var r=ve(t);e=function(n,i){return cr(n,i,r)},t[$t]=e}return e}function Vr(t){var e=t.ia;if(e)return ir(e);if(e=t.va)return nr(t.da.P,e,t.ka)}function Wr(t){var e=Vr(t),r=t.da,n=t.oa.U;return e?function(i,a){return n(i,a,r,e)}:function(i,a){return n(i,a,r)}}function or(t,e){var r=t[e];return typeof r=="function"&&r.length===0&&(r=r(),t[e]=r),Array.isArray(r)&&(Dt in r||It in r||0<r.length&&typeof r[0]=="function")?r:void 0}function sr(t,e,r,n,i,a){e.P=t[0];var s=1;if(t.length>s&&typeof t[s]!="number"){var c=t[s++];r(e,c)}for(;s<t.length;){r=t[s++];for(var f=s+1;f<t.length&&typeof t[f]!="number";)f++;switch(c=t[s++],f-=s,f){case 0:n(e,r,c);break;case 1:(f=or(t,s))?(s++,i(e,r,c,f)):n(e,r,c,t[s++]);break;case 2:f=s++,f=or(t,f),i(e,r,c,f,t[s++]);break;case 3:a(e,r,c,t[s++],t[s++],t[s++]);break;case 4:a(e,r,c,t[s++],t[s++],t[s++],t[s++]);break;default:throw Error("unexpected number of binary field arguments: "+f)}}return e}var Kt=Symbol();function ar(t){var e=t[Kt];if(!e){var r=pe(t);e=function(n,i){return hr(n,i,r)},t[Kt]=e}return e}function ur(t,e){var r=t[Kt];return r||(r=function(n,i){return rr(n,i,e)},t[Kt]=r),r}var It=Symbol();function Xr(t,e){t.push(e)}function Yr(t,e,r){t.push(e,r.W)}function $r(t,e,r,n){var i=ar(n),a=pe(n).P,s=r.W;t.push(e,function(c,f,y){return s(c,f,y,a,i)})}function Kr(t,e,r,n,i,a){var s=ur(n,a),c=r.W;t.push(e,function(f,y,x){return c(f,y,x,n,s)})}function pe(t){var e=t[It];return e||(e=sr(t,t[It]=[],Xr,Yr,$r,Kr),Dt in t&&It in t&&(t.length=0),e)}var Dt=Symbol();function Zr(t,e){t[0]=e}function qr(t,e,r,n){var i=r.U;t[e]=n?function(a,s,c){return i(a,s,c,n)}:i}function Qr(t,e,r,n,i){var a=r.U,s=ir(n),c=ve(n).P;t[e]=function(f,y,x){return a(f,y,x,c,s,i)}}function Jr(t,e,r,n,i,a,s){var c=r.U,f=nr(n,i,a);t[e]=function(y,x,C){return c(y,x,C,n,f,s)}}function ve(t){var e=t[Dt];return e||(e=sr(t,t[Dt]={},Zr,qr,Qr,Jr),Dt in t&&It in t&&(t.length=0),e)}function cr(t,e,r){for(;Ve(e)&&e.i!=4;){var n=e.l,i=r[n];if(!i){var a=r[0];a&&(a=a[n])&&(i=r[n]=Wr(a))}if(!i||!i(e,t,n)){i=e,n=t,a=i.j,Nt(i);var s=i;if(!s.ca){if(i=s.h.h-a,s.h.h=a,s=s.h,i==0)i=ne();else{if(a=Ne(s,i),s.S&&s.m)i=s.i.subarray(a,a+i);else{s=s.i;var c=a;i=a+i,i=c===i?te():Fr?s.slice(c,i):new Uint8Array(s.subarray(c,i))}i=i.length==0?ne():new Ft(i,Ut)}(a=n.R)?a.push(i):n.R=[i]}}}return t}function hr(t,e,r){for(var n=r.length,i=n%2==1,a=i?1:0;a<n;a+=2)(0,r[a+1])(e,t,r[a]);rr(t,e,i?r[0]:void 0)}function Gt(t,e){return{U:t,W:e}}var dt=Gt(function(t,e,r){if(t.i!==5)return!1;t=t.h;var n=t.i,i=t.h,a=n[i],s=n[i+1],c=n[i+2];return n=n[i+3],bt(t,t.h+4),s=(a<<0|s<<8|c<<16|n<<24)>>>0,t=2*(s>>31)+1,a=s>>>23&255,s&=8388607,vt(e,r,a==255?s?NaN:1/0*t:a==0?t*Math.pow(2,-149)*s:t*Math.pow(2,a-150)*(s+Math.pow(2,23))),!0},function(t,e,r){if(e=fe(e,r),e!=null){At(t.h,8*r+5),t=t.h;var n=+e;n===0?0<1/n?Q=nt=0:(nt=0,Q=2147483648):isNaN(n)?(nt=0,Q=2147483647):(n=(r=0>n?-2147483648:0)?-n:n,34028234663852886e22<n?(nt=0,Q=(r|2139095040)>>>0):11754943508222875e-54>n?(n=Math.round(n/Math.pow(2,-149)),nt=0,Q=(r|n)>>>0):(e=Math.floor(Math.log(n)/Math.LN2),n*=Math.pow(2,-e),n=Math.round(8388608*n),16777216<=n&&++e,nt=0,Q=(r|e+127<<23|n&8388607)>>>0)),r=Q,t.h.push(r>>>0&255),t.h.push(r>>>8&255),t.h.push(r>>>16&255),t.h.push(r>>>24&255)}}),tn=Gt(function(t,e,r){if(t.i!==0)return!1;var n=t.h,i=0,a=t=0,s=n.i,c=n.h;do{var f=s[c++];i|=(f&127)<<a,a+=7}while(32>a&&f&128);for(32<a&&(t|=(f&127)>>4),a=3;32>a&&f&128;a+=7)f=s[c++],t|=(f&127)<<a;if(bt(n,c),128>f)n=i>>>0,f=t>>>0,(t=f&2147483648)&&(n=~n+1>>>0,f=~f>>>0,n==0&&(f=f+1>>>0)),n=4294967296*f+(n>>>0);else throw ee();return vt(e,r,t?-n:n),!0},function(t,e,r){e=ft(e,r),e!=null&&(typeof e=="string"&&Te(e),e!=null&&(At(t.h,8*r),typeof e=="number"?(t=t.h,Be(e),ze(t,Q,nt)):(r=Te(e),ze(t.h,r.i,r.h))))}),en=Gt(function(t,e,r){return t.i!==0?!1:(vt(e,r,Rt(t.h)),!0)},function(t,e,r){if(e=ft(e,r),e!=null&&e!=null)if(At(t.h,8*r),t=t.h,r=e,0<=r)At(t,r);else{for(e=0;9>e;e++)t.h.push(r&127|128),r>>=7;t.h.push(1)}}),lr=Gt(function(t,e,r){if(t.i!==2)return!1;var n=Rt(t.h)>>>0;t=t.h;var i=Ne(t,n);if(t=t.i,_r){var a=t,s;(s=re)||(s=re=new TextDecoder("utf-8",{fatal:!0})),t=i+n,a=i===0&&t===a.length?a:a.subarray(i,t);try{var c=s.decode(a)}catch(C){if(kt===void 0){try{s.decode(new Uint8Array([128]))}catch{}try{s.decode(new Uint8Array([97])),kt=!0}catch{kt=!1}}throw!kt&&(re=void 0),C}}else{c=i,n=c+n,i=[];for(var f=null,y,x;c<n;)y=t[c++],128>y?i.push(y):224>y?c>=n?St():(x=t[c++],194>y||(x&192)!==128?(c--,St()):i.push((y&31)<<6|x&63)):240>y?c>=n-1?St():(x=t[c++],(x&192)!==128||y===224&&160>x||y===237&&160<=x||((a=t[c++])&192)!==128?(c--,St()):i.push((y&15)<<12|(x&63)<<6|a&63)):244>=y?c>=n-2?St():(x=t[c++],(x&192)!==128||(y<<28)+(x-144)>>30!==0||((a=t[c++])&192)!==128||((s=t[c++])&192)!==128?(c--,St()):(y=(y&7)<<18|(x&63)<<12|(a&63)<<6|s&63,y-=65536,i.push((y>>10&1023)+55296,(y&1023)+56320))):St(),8192<=i.length&&(f=_e(f,i),i.length=0);c=_e(f,i)}return vt(e,r,c),!0},function(t,e,r){if(e=ft(e,r),e!=null){var n=!1;if(n=n===void 0?!1:n,Lr){if(n&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(e))throw Error("Found an unpaired surrogate");e=(Le||(Le=new TextEncoder)).encode(e)}else{for(var i=0,a=new Uint8Array(3*e.length),s=0;s<e.length;s++){var c=e.charCodeAt(s);if(128>c)a[i++]=c;else{if(2048>c)a[i++]=c>>6|192;else{if(55296<=c&&57343>=c){if(56319>=c&&s<e.length){var f=e.charCodeAt(++s);if(56320<=f&&57343>=f){c=1024*(c-55296)+f-56320+65536,a[i++]=c>>18|240,a[i++]=c>>12&63|128,a[i++]=c>>6&63|128,a[i++]=c&63|128;continue}else s--}if(n)throw Error("Found an unpaired surrogate");c=65533}a[i++]=c>>12|224,a[i++]=c>>6&63|128}a[i++]=c&63|128}}e=i===a.length?a:a.subarray(0,i)}At(t.h,8*r+2),At(t.h,e.length),Pt(t,t.h.end()),Pt(t,e)}}),fr=Gt(function(t,e,r,n,i){if(t.i!==2)return!1;e=Ke(e,r,n),r=t.h.j,n=Rt(t.h)>>>0;var a=t.h.h+n,s=a-r;if(0>=s&&(t.h.j=a,i(e,t,void 0,void 0,void 0),s=a-t.h.h),s)throw Error("Message parsing ended unexpectedly. Expected to read "+(n+" bytes, instead read "+(n-s)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return t.h.h=a,t.h.j=r,!0},function(t,e,r,n,i){if(e=Wt(e,n,r),e!=null)for(n=0;n<e.length;n++){var a=t;At(a.h,8*r+2);var s=a.h.end();Pt(a,s),s.push(a.i),a=s,i(e[n],t),s=t;var c=a.pop();for(c=s.i+s.h.length()-c;127<c;)a.push(c&127|128),c>>>=7,s.i++;a.push(c),s.i++}});function me(t){return function(e,r){t:{if(Ht.length){var n=Ht.pop();n.setOptions(r),ie(n.h,e,r),e=n}else e=new se(e,r);try{var i=ve(t),a=cr(new i.P,e,i);break t}finally{i=e.h,i.i=null,i.m=!1,i.l=0,i.j=0,i.h=0,i.S=!1,e.l=-1,e.i=-1,100>Ht.length&&Ht.push(e)}a=void 0}return a}}function ye(t){return function(){var e=new Dr;hr(this,e,pe(t)),Pt(e,e.h.end());for(var r=new Uint8Array(e.i),n=e.j,i=n.length,a=0,s=0;s<i;s++){var c=n[s];r.set(c,a),a+=c.length}return e.j=[r],r}}function Bt(t){it.call(this,t)}z(Bt,it);var dr=[Bt,1,en,2,dt,3,lr,4,lr];Bt.prototype.l=ye(dr);function ge(t){it.call(this,t,-1,rn)}z(ge,it),ge.prototype.addClassification=function(t,e){return Ke(this,1,Bt,t,e),this};var rn=[1],pr=me([ge,1,fr,dr]);function Ot(t){it.call(this,t)}z(Ot,it);var vr=[Ot,1,dt,2,dt,3,dt,4,dt,5,dt];Ot.prototype.l=ye(vr);function mr(t){it.call(this,t,-1,nn)}z(mr,it);var nn=[1],yr=me([mr,1,fr,vr]);function Zt(t){it.call(this,t)}z(Zt,it);var gr=[Zt,1,dt,2,dt,3,dt,4,dt,5,dt,6,tn],on=me(gr);Zt.prototype.l=ye(gr);function wr(t,e,r){if(r=t.createShader(r===0?t.VERTEX_SHADER:t.FRAGMENT_SHADER),t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+t.getShaderInfoLog(r));return r}function xr(t){return Wt(t,Bt,1).map(function(e){var r=ft(e,1);return{index:r??0,score:yt(e,2),label:ft(e,3)!=null?Xt(ft(e,3),""):void 0,displayName:ft(e,4)!=null?Xt(ft(e,4),""):void 0}})}function Sr(t){return{x:yt(t,1),y:yt(t,2),z:yt(t,3),visibility:fe(t,4)!=null?yt(t,4):void 0}}function br(t){return t.map(function(e){return Wt(yr(e),Ot,1).map(Sr)})}function we(t,e){this.i=t,this.h=e,this.m=0}function Ar(t,e,r){return sn(t,e),typeof t.h.canvas.transferToImageBitmap=="function"?Promise.resolve(t.h.canvas.transferToImageBitmap()):r?Promise.resolve(t.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(t.h.canvas):(t.j===void 0&&(t.j=document.createElement("canvas")),new Promise(function(n){t.j.height=t.h.canvas.height,t.j.width=t.h.canvas.width,t.j.getContext("2d",{}).drawImage(t.h.canvas,0,0,t.h.canvas.width,t.h.canvas.height),n(t.j)}))}function sn(t,e){var r=t.h;if(t.s===void 0){var n=wr(r,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),i=wr(r,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),a=r.createProgram();if(r.attachShader(a,n),r.attachShader(a,i),r.linkProgram(a),!r.getProgramParameter(a,r.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+r.getProgramInfoLog(a));n=t.s=a,r.useProgram(n),i=r.getUniformLocation(n,"sampler0"),t.l={O:r.getAttribLocation(n,"aVertex"),N:r.getAttribLocation(n,"aTex"),xa:i},t.v=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,t.v),r.enableVertexAttribArray(t.l.O),r.vertexAttribPointer(t.l.O,2,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),t.u=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,t.u),r.enableVertexAttribArray(t.l.N),r.vertexAttribPointer(t.l.N,2,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),r.uniform1i(i,0)}n=t.l,r.useProgram(t.s),r.canvas.width=e.width,r.canvas.height=e.height,r.viewport(0,0,e.width,e.height),r.activeTexture(r.TEXTURE0),t.i.bindTexture2d(e.glName),r.enableVertexAttribArray(n.O),r.bindBuffer(r.ARRAY_BUFFER,t.v),r.vertexAttribPointer(n.O,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(n.N),r.bindBuffer(r.ARRAY_BUFFER,t.u),r.vertexAttribPointer(n.N,2,r.FLOAT,!1,0,0),r.bindFramebuffer(r.DRAW_FRAMEBUFFER?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,null),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.colorMask(!0,!0,!0,!0),r.drawArrays(r.TRIANGLE_FAN,0,4),r.disableVertexAttribArray(n.O),r.disableVertexAttribArray(n.N),r.bindBuffer(r.ARRAY_BUFFER,null),t.i.bindTexture2d(0)}function an(t){this.h=t}var un=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function cn(t,e){return e+t}function jr(t,e){window[t]=e}function hn(t){var e=document.createElement("script");return e.setAttribute("src",t),e.setAttribute("crossorigin","anonymous"),new Promise(function(r){e.addEventListener("load",function(){r()},!1),e.addEventListener("error",function(){r()},!1),document.body.appendChild(e)})}function ln(){return m(function(t){switch(t.h){case 1:return t.s=2,P(t,WebAssembly.instantiate(un),4);case 4:t.h=3,t.s=0;break;case 2:return t.s=0,t.l=null,t.return(!1);case 3:return t.return(!0)}})}function xe(t){if(this.h=t,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=t&&t.locateFile||cn,typeof window=="object")var e=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")e=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=e,t.options){e=g(Object.keys(t.options));for(var r=e.next();!r.done;r=e.next()){r=r.value;var n=t.options[r].default;n!==void 0&&(this.l[r]=typeof n=="function"?n():n)}}}u=xe.prototype,u.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function fn(t){var e,r,n,i,a,s,c,f,y,x,C;return m(function(j){switch(j.h){case 1:return t.ga?(e=t.h.files===void 0?[]:typeof t.h.files=="function"?t.h.files(t.l):t.h.files,P(j,ln(),2)):j.return();case 2:if(r=j.i,typeof window=="object")return jr("createMediapipeSolutionsWasm",{locateFile:t.locateFile}),jr("createMediapipeSolutionsPackedAssets",{locateFile:t.locateFile}),s=e.filter(function(b){return b.data!==void 0}),c=e.filter(function(b){return b.data===void 0}),f=Promise.all(s.map(function(b){var T=qt(t,b.url);if(b.path!==void 0){var L=b.path;T=T.then(function(Y){return t.overrideFile(L,Y),Promise.resolve(Y)})}return T})),y=Promise.all(c.map(function(b){return b.simd===void 0||b.simd&&r||!b.simd&&!r?hn(t.locateFile(b.url,t.ha)):Promise.resolve()})).then(function(){var b,T,L;return m(function(Y){if(Y.h==1)return b=window.createMediapipeSolutionsWasm,T=window.createMediapipeSolutionsPackedAssets,L=t,P(Y,b(T),2);L.i=Y.i,Y.h=0})}),x=(function(){return m(function(b){return t.h.graph&&t.h.graph.url?b=P(b,qt(t,t.h.graph.url),0):(b.h=0,b=void 0),b})})(),P(j,Promise.all([y,f,x]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return n=e.filter(function(b){return b.simd===void 0||b.simd&&r||!b.simd&&!r}).map(function(b){return t.locateFile(b.url,t.ha)}),importScripts.apply(null,A(n)),i=t,P(j,createMediapipeSolutionsWasm(Module),6);case 6:i.i=j.i,t.m=new OffscreenCanvas(1,1),t.i.canvas=t.m,a=t.i.GL.createContext(t.m,{antialias:!1,alpha:!1,ua:typeof WebGL2RenderingContext<"u"?2:1}),t.i.GL.makeContextCurrent(a),j.h=4;break;case 7:if(t.m=document.createElement("canvas"),C=t.m.getContext("webgl2",{}),!C&&(C=t.m.getContext("webgl",{}),!C))return alert("Failed to create WebGL canvas context when passing video frame."),j.return();t.K=C,t.i.canvas=t.m,t.i.createContext(t.m,!0,!0,{});case 4:t.j=new t.i.SolutionWasm,t.ga=!1,j.h=0}})}function dn(t){var e,r,n,i,a,s,c,f;return m(function(y){if(y.h==1){if(t.h.graph&&t.h.graph.url&&t.fa===t.h.graph.url)return y.return();if(t.u=!0,!t.h.graph||!t.h.graph.url){y.h=2;return}return t.fa=t.h.graph.url,P(y,qt(t,t.h.graph.url),3)}for(y.h!=2&&(e=y.i,t.j.loadGraph(e)),r=g(Object.keys(t.D)),n=r.next();!n.done;n=r.next())i=n.value,t.j.overrideFile(i,t.D[i]);if(t.D={},t.h.listeners)for(a=g(t.h.listeners),s=a.next();!s.done;s=a.next())c=s.value,yn(t,c);f=t.l,t.l={},t.setOptions(f),y.h=0})}u.reset=function(){var t=this;return m(function(e){t.j&&(t.j.reset(),t.s={},t.v={}),e.h=0})},u.setOptions=function(t,e){var r=this;if(e=e||this.h.options){for(var n=[],i=[],a={},s=g(Object.keys(t)),c=s.next();!c.done;a={X:a.X,Y:a.Y},c=s.next())if(c=c.value,!(c in this.l&&this.l[c]===t[c])){this.l[c]=t[c];var f=e[c];f!==void 0&&(f.onChange&&(a.X=f.onChange,a.Y=t[c],n.push((function(y){return function(){var x;return m(function(C){if(C.h==1)return P(C,y.X(y.Y),2);x=C.i,x===!0&&(r.u=!0),C.h=0})}})(a))),f.graphOptionXref&&(c=Object.assign({},{calculatorName:"",calculatorIndex:0},f.graphOptionXref,{valueNumber:f.type===1?t[c]:0,valueBoolean:f.type===0?t[c]:!1,valueString:f.type===2?t[c]:""}),i.push(c)))}(n.length!==0||i.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(i),this.F=(this.F===void 0?[]:this.F).concat(n))}};function pn(t){var e,r,n,i,a,s,c;return m(function(f){switch(f.h){case 1:if(!t.u)return f.return();if(!t.F){f.h=2;break}e=g(t.F),r=e.next();case 3:if(r.done){f.h=5;break}return n=r.value,P(f,n(),4);case 4:r=e.next(),f.h=3;break;case 5:t.F=void 0;case 2:if(t.H){for(i=new t.i.GraphOptionChangeRequestList,a=g(t.H),s=a.next();!s.done;s=a.next())c=s.value,i.push_back(c);t.j.changeOptions(i),i.delete(),t.H=void 0}t.u=!1,f.h=0}})}u.initialize=function(){var t=this;return m(function(e){return e.h==1?P(e,fn(t),2):e.h!=3?P(e,dn(t),3):P(e,pn(t),0)})};function qt(t,e){var r,n;return m(function(i){return e in t.L?i.return(t.L[e]):(r=t.locateFile(e,""),n=fetch(r).then(function(a){return a.arrayBuffer()}),t.L[e]=n,i.return(n))})}u.overrideFile=function(t,e){this.j?this.j.overrideFile(t,e):this.D[t]=e},u.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},u.send=function(t,e){var r=this,n,i,a,s,c,f,y,x,C;return m(function(j){switch(j.h){case 1:return r.h.inputs?(n=1e3*(e??performance.now()),P(j,r.I,2)):j.return();case 2:return P(j,r.initialize(),3);case 3:for(i=new r.i.PacketDataList,a=g(Object.keys(t)),s=a.next();!s.done;s=a.next())if(c=s.value,f=r.h.inputs[c]){t:{var b=t[c];switch(f.type){case"video":var T=r.s[f.stream];if(T||(T=new we(r.i,r.K),r.s[f.stream]=T),T.m===0&&(T.m=T.i.createTexture()),typeof HTMLVideoElement<"u"&&b instanceof HTMLVideoElement)var L=b.videoWidth,Y=b.videoHeight;else typeof HTMLImageElement<"u"&&b instanceof HTMLImageElement?(L=b.naturalWidth,Y=b.naturalHeight):(L=b.width,Y=b.height);Y={glName:T.m,width:L,height:Y},L=T.h,L.canvas.width=Y.width,L.canvas.height=Y.height,L.activeTexture(L.TEXTURE0),T.i.bindTexture2d(T.m),L.texImage2D(L.TEXTURE_2D,0,L.RGBA,L.RGBA,L.UNSIGNED_BYTE,b),T.i.bindTexture2d(0),T=Y;break t;case"detections":for(T=r.s[f.stream],T||(T=new an(r.i),r.s[f.stream]=T),T.data||(T.data=new T.h.DetectionListData),T.data.reset(b.length),Y=0;Y<b.length;++Y){L=b[Y];var V=T.data,et=V.setBoundingBox,ct=Y,ot=L.la,G=new Zt;if(mt(G,1,ot.ra),mt(G,2,ot.sa),mt(G,3,ot.height),mt(G,4,ot.width),mt(G,5,ot.rotation),vt(G,6,ot.pa),ot=G.l(),et.call(V,ct,ot),L.ea)for(V=0;V<L.ea.length;++V){G=L.ea[V],et=T.data,ct=et.addNormalizedLandmark,ot=Y,G=Object.assign({},G,{visibility:G.visibility?G.visibility:0});var rt=new Ot;mt(rt,1,G.x),mt(rt,2,G.y),mt(rt,3,G.z),G.visibility&&mt(rt,4,G.visibility),G=rt.l(),ct.call(et,ot,G)}if(L.ba)for(V=0;V<L.ba.length;++V)et=T.data,ct=et.addClassification,ot=Y,G=L.ba[V],rt=new Bt,mt(rt,2,G.score),G.index&&vt(rt,1,G.index),G.label&&vt(rt,3,G.label),G.displayName&&vt(rt,4,G.displayName),G=rt.l(),ct.call(et,ot,G)}T=T.data;break t;default:T={}}}switch(y=T,x=f.stream,f.type){case"video":i.pushTexture2d(Object.assign({},y,{stream:x,timestamp:n}));break;case"detections":C=y,C.stream=x,C.timestamp=n,i.pushDetectionList(C);break;default:throw Error("Unknown input config type: '"+f.type+"'")}}return r.j.send(i),P(j,r.I,4);case 4:i.delete(),j.h=0}})};function vn(t,e,r){var n,i,a,s,c,f,y,x,C,j,b,T,L,Y;return m(function(V){switch(V.h){case 1:if(!r)return V.return(e);for(n={},i=0,a=g(Object.keys(r)),s=a.next();!s.done;s=a.next())c=s.value,f=r[c],typeof f!="string"&&f.type==="texture"&&e[f.stream]!==void 0&&++i;1<i&&(t.M=!1),y=g(Object.keys(r)),s=y.next();case 2:if(s.done){V.h=4;break}if(x=s.value,C=r[x],typeof C=="string")return L=n,Y=x,P(V,mn(t,x,e[C]),14);if(j=e[C.stream],C.type==="detection_list"){if(j){for(var et=j.getRectList(),ct=j.getLandmarksList(),ot=j.getClassificationsList(),G=[],rt=0;rt<et.size();++rt){var wt=on(et.get(rt)),gn=yt(wt,1),wn=yt(wt,2),xn=yt(wt,3),Sn=yt(wt,4),bn=yt(wt,5,0),Qt=void 0;Qt=Qt===void 0?0:Qt,wt={la:{ra:gn,sa:wn,height:xn,width:Sn,rotation:bn,pa:Xt(ft(wt,6),Qt)},ea:Wt(yr(ct.get(rt)),Ot,1).map(Sr),ba:xr(pr(ot.get(rt)))},G.push(wt)}et=G}else et=[];n[x]=et,V.h=7;break}if(C.type==="proto_list"){if(j){for(et=Array(j.size()),ct=0;ct<j.size();ct++)et[ct]=j.get(ct);j.delete()}else et=[];n[x]=et,V.h=7;break}if(j===void 0){V.h=3;break}if(C.type==="float_list"){n[x]=j,V.h=7;break}if(C.type==="proto"){n[x]=j,V.h=7;break}if(C.type!=="texture")throw Error("Unknown output config type: '"+C.type+"'");return b=t.v[x],b||(b=new we(t.i,t.K),t.v[x]=b),P(V,Ar(b,j,t.M),13);case 13:T=V.i,n[x]=T;case 7:C.transform&&n[x]&&(n[x]=C.transform(n[x])),V.h=3;break;case 14:L[Y]=V.i;case 3:s=y.next(),V.h=2;break;case 4:return V.return(n)}})}function mn(t,e,r){var n;return m(function(i){return typeof r=="number"||r instanceof Uint8Array||r instanceof t.i.Uint8BlobList?i.return(r):r instanceof t.i.Texture2dDataOut?(n=t.v[e],n||(n=new we(t.i,t.K),t.v[e]=n),i.return(Ar(n,r,t.M))):i.return(void 0)})}function yn(t,e){for(var r=e.name||"$",n=[].concat(A(e.wants)),i=new t.i.StringList,a=g(e.wants),s=a.next();!s.done;s=a.next())i.push_back(s.value);a=t.i.PacketListener.implement({onResults:function(c){for(var f={},y=0;y<e.wants.length;++y)f[n[y]]=c.get(y);var x=t.listeners[r];x&&(t.I=vn(t,f,e.outs).then(function(C){C=x(C);for(var j=0;j<e.wants.length;++j){var b=f[n[j]];typeof b=="object"&&b.hasOwnProperty&&b.hasOwnProperty("delete")&&b.delete()}C&&(t.I=C)}))}}),t.j.attachMultiListener(i,a),i.delete()}u.onResults=function(t,e){this.listeners[e||"$"]=t},Z("Solution",xe),Z("OptionType",{BOOL:0,NUMBER:1,ta:2,0:"BOOL",1:"NUMBER",2:"STRING"});function Er(t){return t===void 0&&(t=0),t===1?"hand_landmark_full.tflite":"hand_landmark_lite.tflite"}function Mr(t){var e=this;t=t||{},this.h=new xe({locateFile:t.locateFile,files:function(r){return[{url:"hands_solution_packed_assets_loader.js"},{simd:!1,url:"hands_solution_wasm_bin.js"},{simd:!0,url:"hands_solution_simd_wasm_bin.js"},{data:!0,url:Er(r.modelComplexity)}]},graph:{url:"hands.binarypb"},inputs:{image:{type:"video",stream:"input_frames_gpu"}},listeners:[{wants:["multi_hand_landmarks","multi_hand_world_landmarks","image_transformed","multi_handedness"],outs:{image:"image_transformed",multiHandLandmarks:{type:"proto_list",stream:"multi_hand_landmarks",transform:br},multiHandWorldLandmarks:{type:"proto_list",stream:"multi_hand_world_landmarks",transform:br},multiHandedness:{type:"proto_list",stream:"multi_handedness",transform:function(r){return r.map(function(n){return xr(pr(n))[0]})}}}}],options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},maxNumHands:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculator",fieldName:"int_value"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(r){var n,i,a;return m(function(s){return s.h==1?(n=Er(r),i="third_party/mediapipe/modules/hand_landmark/"+n,P(s,qt(e.h,n),2)):(a=s.i,e.h.overrideFile(i,a),s.return(!0))})}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"handlandmarktrackinggpu__palmdetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"handlandmarktrackinggpu__handlandmarkgpu__ThresholdingCalculator",fieldName:"threshold"}}}})}u=Mr.prototype,u.close=function(){return this.h.close(),Promise.resolve()},u.onResults=function(t){this.h.onResults(t)},u.initialize=function(){var t=this;return m(function(e){return P(e,t.h.initialize(),0)})},u.reset=function(){this.h.reset()},u.send=function(t){var e=this;return m(function(r){return P(r,e.h.send(t),0)})},u.setOptions=function(t){this.h.setOptions(t)},Z("Hands",Mr),Z("HAND_CONNECTIONS",[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]]),Z("VERSION","0.4.1675469240")}).call(Ae)),Ae}var kn=Gn(),je={},Cr;function Nn(){return Cr||(Cr=1,(function(){function u(p){var m=0;return function(){return m<p.length?{done:!1,value:p[m++]}:{done:!0}}}var o=typeof Object.defineProperties=="function"?Object.defineProperty:function(p,m,U){return p==Array.prototype||p==Object.prototype||(p[m]=U.value),p};function l(p){p=[typeof globalThis=="object"&&globalThis,p,typeof window=="object"&&window,typeof self=="object"&&self,typeof Jt=="object"&&Jt];for(var m=0;m<p.length;++m){var U=p[m];if(U&&U.Math==Math)return U}throw Error("Cannot find global object")}var d=l(this);function h(p,m){if(m)t:{var U=d;p=p.split(".");for(var M=0;M<p.length-1;M++){var N=p[M];if(!(N in U))break t;U=U[N]}p=p[p.length-1],M=U[p],m=m(M),m!=M&&m!=null&&o(U,p,{configurable:!0,writable:!0,value:m})}}h("Symbol",function(p){function m(Z){if(this instanceof m)throw new TypeError("Symbol is not a constructor");return new U(M+(Z||"")+"_"+N++,Z)}function U(Z,w){this.g=Z,o(this,"description",{configurable:!0,writable:!0,value:w})}if(p)return p;U.prototype.toString=function(){return this.g};var M="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",N=0;return m}),h("Symbol.iterator",function(p){if(p)return p;p=Symbol("Symbol.iterator");for(var m="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),U=0;U<m.length;U++){var M=d[m[U]];typeof M=="function"&&typeof M.prototype[p]!="function"&&o(M.prototype,p,{configurable:!0,writable:!0,value:function(){return v(u(this))}})}return p});function v(p){return p={next:p},p[Symbol.iterator]=function(){return this},p}function S(p){var m=typeof Symbol<"u"&&Symbol.iterator&&p[Symbol.iterator];return m?m.call(p):{next:u(p)}}function g(){this.i=!1,this.g=null,this.o=void 0,this.j=1,this.m=0,this.h=null}function A(p){if(p.i)throw new TypeError("Generator is already running");p.i=!0}g.prototype.l=function(p){this.o=p};function B(p,m){p.h={F:m,G:!0},p.j=p.m}g.prototype.return=function(p){this.h={return:p},this.j=this.m};function E(p){this.g=new g,this.h=p}function _(p,m){A(p.g);var U=p.g.g;return U?F(p,"return"in U?U.return:function(M){return{value:M,done:!0}},m,p.g.return):(p.g.return(m),R(p))}function F(p,m,U,M){try{var N=m.call(p.g.g,U);if(!(N instanceof Object))throw new TypeError("Iterator result "+N+" is not an object");if(!N.done)return p.g.i=!1,N;var Z=N.value}catch(w){return p.g.g=null,B(p.g,w),R(p)}return p.g.g=null,M.call(p.g,Z),R(p)}function R(p){for(;p.g.j;)try{var m=p.h(p.g);if(m)return p.g.i=!1,{value:m.value,done:!1}}catch(U){p.g.o=void 0,B(p.g,U)}if(p.g.i=!1,p.g.h){if(m=p.g.h,p.g.h=null,m.G)throw m.F;return{value:m.return,done:!0}}return{value:void 0,done:!0}}function W(p){this.next=function(m){return A(p.g),p.g.g?m=F(p,p.g.g.next,m,p.g.l):(p.g.l(m),m=R(p)),m},this.throw=function(m){return A(p.g),p.g.g?m=F(p,p.g.g.throw,m,p.g.l):(B(p.g,m),m=R(p)),m},this.return=function(m){return _(p,m)},this[Symbol.iterator]=function(){return this}}function $(p){function m(M){return p.next(M)}function U(M){return p.throw(M)}return new Promise(function(M,N){function Z(w){w.done?M(w.value):Promise.resolve(w.value).then(m,U).then(Z,N)}Z(p.next())})}h("Promise",function(p){function m(w){this.h=0,this.i=void 0,this.g=[],this.o=!1;var O=this.j();try{w(O.resolve,O.reject)}catch(D){O.reject(D)}}function U(){this.g=null}function M(w){return w instanceof m?w:new m(function(O){O(w)})}if(p)return p;U.prototype.h=function(w){if(this.g==null){this.g=[];var O=this;this.i(function(){O.l()})}this.g.push(w)};var N=d.setTimeout;U.prototype.i=function(w){N(w,0)},U.prototype.l=function(){for(;this.g&&this.g.length;){var w=this.g;this.g=[];for(var O=0;O<w.length;++O){var D=w[O];w[O]=null;try{D()}catch(X){this.j(X)}}}this.g=null},U.prototype.j=function(w){this.i(function(){throw w})},m.prototype.j=function(){function w(X){return function(at){D||(D=!0,X.call(O,at))}}var O=this,D=!1;return{resolve:w(this.A),reject:w(this.l)}},m.prototype.A=function(w){if(w===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(w instanceof m)this.C(w);else{t:switch(typeof w){case"object":var O=w!=null;break t;case"function":O=!0;break t;default:O=!1}O?this.v(w):this.m(w)}},m.prototype.v=function(w){var O=void 0;try{O=w.then}catch(D){this.l(D);return}typeof O=="function"?this.D(O,w):this.m(w)},m.prototype.l=function(w){this.u(2,w)},m.prototype.m=function(w){this.u(1,w)},m.prototype.u=function(w,O){if(this.h!=0)throw Error("Cannot settle("+w+", "+O+"): Promise already settled in state"+this.h);this.h=w,this.i=O,this.h===2&&this.B(),this.H()},m.prototype.B=function(){var w=this;N(function(){if(w.I()){var O=d.console;typeof O<"u"&&O.error(w.i)}},1)},m.prototype.I=function(){if(this.o)return!1;var w=d.CustomEvent,O=d.Event,D=d.dispatchEvent;return typeof D>"u"?!0:(typeof w=="function"?w=new w("unhandledrejection",{cancelable:!0}):typeof O=="function"?w=new O("unhandledrejection",{cancelable:!0}):(w=d.document.createEvent("CustomEvent"),w.initCustomEvent("unhandledrejection",!1,!0,w)),w.promise=this,w.reason=this.i,D(w))},m.prototype.H=function(){if(this.g!=null){for(var w=0;w<this.g.length;++w)Z.h(this.g[w]);this.g=null}};var Z=new U;return m.prototype.C=function(w){var O=this.j();w.s(O.resolve,O.reject)},m.prototype.D=function(w,O){var D=this.j();try{w.call(O,D.resolve,D.reject)}catch(X){D.reject(X)}},m.prototype.then=function(w,O){function D(ut,lt){return typeof ut=="function"?function(Et){try{X(ut(Et))}catch(Mt){at(Mt)}}:lt}var X,at,Tt=new m(function(ut,lt){X=ut,at=lt});return this.s(D(w,X),D(O,at)),Tt},m.prototype.catch=function(w){return this.then(void 0,w)},m.prototype.s=function(w,O){function D(){switch(X.h){case 1:w(X.i);break;case 2:O(X.i);break;default:throw Error("Unexpected state: "+X.h)}}var X=this;this.g==null?Z.h(D):this.g.push(D),this.o=!0},m.resolve=M,m.reject=function(w){return new m(function(O,D){D(w)})},m.race=function(w){return new m(function(O,D){for(var X=S(w),at=X.next();!at.done;at=X.next())M(at.value).s(O,D)})},m.all=function(w){var O=S(w),D=O.next();return D.done?M([]):new m(function(X,at){function Tt(Et){return function(Mt){ut[Et]=Mt,lt--,lt==0&&X(ut)}}var ut=[],lt=0;do ut.push(void 0),lt++,M(D.value).s(Tt(ut.length-1),at),D=O.next();while(!D.done)})},m});var z=typeof Object.assign=="function"?Object.assign:function(p,m){for(var U=1;U<arguments.length;U++){var M=arguments[U];if(M)for(var N in M)Object.prototype.hasOwnProperty.call(M,N)&&(p[N]=M[N])}return p};h("Object.assign",function(p){return p||z});var q=this||self,tt={facingMode:"user",width:640,height:480};function I(p,m){this.video=p,this.i=0,this.h=Object.assign(Object.assign({},tt),m)}I.prototype.stop=function(){var p=this,m,U,M,N;return $(new W(new E(function(Z){if(p.g){for(m=p.g.getTracks(),U=S(m),M=U.next();!M.done;M=U.next())N=M.value,N.stop();p.g=void 0}Z.j=0})))},I.prototype.start=function(){var p=this,m;return $(new W(new E(function(U){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||alert("No navigator.mediaDevices.getUserMedia exists."),m=p.h,U.return(navigator.mediaDevices.getUserMedia({video:{facingMode:m.facingMode,width:m.width,height:m.height}}).then(function(M){k(p,M)}).catch(function(M){var N="Failed to acquire camera feed: "+M;throw console.error(N),alert(N),M}))})))};function P(p){window.requestAnimationFrame(function(){H(p)})}function k(p,m){p.g=m,p.video.srcObject=m,p.video.onloadedmetadata=function(){p.video.play(),P(p)}}function H(p){var m=null;p.video.paused||p.video.currentTime===p.i||(p.i=p.video.currentTime,m=p.h.onFrame()),m?m.then(function(){P(p)}):P(p)}var ht=["Camera"],J=q;ht[0]in J||typeof J.execScript>"u"||J.execScript("var "+ht[0]);for(var st;ht.length&&(st=ht.shift());)ht.length||I===void 0?J[st]&&J[st]!==Object.prototype[st]?J=J[st]:J=J[st]={}:J[st]=I}).call(je)),je}var Hn=Nn();class zn{constructor(){this.hands=null,this.camera=null,this.video=null,this.isRunning=!1,this.currentHandPos=null,this.smoothedHandPos={x:window.innerWidth/2,y:window.innerHeight/2},this.smoothing=.3,this.handDetected=!1}async init(){this.video=document.createElement("video"),this.video.style.display="none",this.video.width=640,this.video.height=480,document.body.appendChild(this.video),this.hands=new kn.Hands({locateFile:o=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${o}`}),this.hands.setOptions({maxNumHands:1,modelComplexity:1,minDetectionConfidence:.5,minTrackingConfidence:.5}),this.hands.onResults(o=>this.onResults(o))}async start(){this.isRunning||(this.camera=new Hn.Camera(this.video,{onFrame:async()=>{await this.hands.send({image:this.video})},width:640,height:480}),await this.camera.start(),this.isRunning=!0)}onResults(o){if(o.multiHandLandmarks&&o.multiHandLandmarks.length>0){this.handDetected=!0;const d=o.multiHandLandmarks[0][8],h=(1-d.x)*window.innerWidth,v=d.y*window.innerHeight;this.currentHandPos={x:h,y:v},this.smoothedHandPos.x=this.smoothedHandPos.x*(1-this.smoothing)+this.currentHandPos.x*this.smoothing,this.smoothedHandPos.y=this.smoothedHandPos.y*(1-this.smoothing)+this.currentHandPos.y*this.smoothing}else this.handDetected=!1,this.currentHandPos=null}getPointerPosition(){return this.isRunning&&this.currentHandPos?this.smoothedHandPos:null}isHandDetected(){return this.handDetected}stop(){this.isRunning&&(this.camera&&this.camera.stop(),this.isRunning=!1)}destroy(){this.stop(),this.video&&this.video.parentNode&&this.video.parentNode.removeChild(this.video),this.hands&&this.hands.close()}}class Vn{constructor(o){this.renderer=o,this.device=o.device,this.particles=[]}reset(){this.particles.forEach(o=>{o.vertexBuffer?.destroy(),o.uniformBuffer?.destroy()}),this.particles=[]}createExplosion(o,l){for(let h=0;h<30;h++){const v=2+Math.random()*3,S=[(Math.random()-.5)*v*2,(Math.random()-.5)*v*2,(Math.random()-.5)*v*2],g={position:[...o],velocity:S,color:l||[1,.5,0],life:1,size:.05+Math.random()*.08};g.uniformBuffer=this.device.createBuffer({size:80,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),g.bindGroup=this.device.createBindGroup({layout:this.renderer.genericBindGroupLayout,entries:[{binding:0,resource:{buffer:this.renderer.cameraUniformBuffer}},{binding:1,resource:{buffer:g.uniformBuffer}}]}),this.createParticleGeometry(g),this.particles.push(g)}}createParticleGeometry(o){const l=o.size,d=[-l,-l,0,...o.color,l,-l,0,...o.color,l,l,0,...o.color,-l,-l,0,...o.color,l,l,0,...o.color,-l,l,0,...o.color],h=new Float32Array(d);o.vertexBuffer=this.device.createBuffer({size:h.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),this.device.queue.writeBuffer(o.vertexBuffer,0,h)}update(o){for(let l=this.particles.length-1;l>=0;l--){const d=this.particles[l];d.position[0]+=d.velocity[0]*o,d.position[1]+=d.velocity[1]*o,d.position[2]+=d.velocity[2]*o,d.velocity[1]-=2*o,d.life-=o*.8,d.life<=0&&(d.vertexBuffer?.destroy(),d.uniformBuffer?.destroy(),this.particles.splice(l,1))}}getParticles(){return this.particles}}class Wn{constructor(){this.audioContext=null,this.initialized=!1}async init(){if(!this.initialized){if(!window.AudioContext&&!window.webkitAudioContext){console.warn("Web Audio API not supported");return}this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.initialized=!0}}playShootSound(){if(!this.audioContext&&(this.init(),!this.audioContext))return;this.audioContext.state==="suspended"&&this.audioContext.resume();const o=this.audioContext.currentTime,l=.15,d=this.audioContext.createOscillator(),h=this.audioContext.createOscillator(),v=this.audioContext.createGain(),S=this.audioContext.createBiquadFilter();S.type="highpass",S.frequency.value=4e3,d.type="sine",d.frequency.setValueAtTime(400,o),d.frequency.exponentialRampToValueAtTime(300,o+l),h.type="square",h.frequency.setValueAtTime(600,o),h.frequency.exponentialRampToValueAtTime(200,o+l),v.gain.setValueAtTime(.3,o),v.gain.exponentialRampToValueAtTime(.01,o+l),d.connect(v),h.connect(v),v.connect(S),S.connect(this.audioContext.destination),d.start(o),h.start(o),d.stop(o+l),h.stop(o+l)}}class Xn{constructor(){this.canvas=document.getElementById("gpuCanvas"),this.renderer=null,this.gameState=null,this.shapeSpawner=null,this.handTracker=null,this.particleSystem=null,this.soundManager=null,this.music=document.getElementById("background-music"),this.isInitialized=!1,this.lastTime=performance.now(),this.crosshair=document.getElementById("crosshair"),this.handIndicator=document.getElementById("handIndicator"),this.handStatus=document.getElementById("handStatus"),this.currentGameState="initializing",this.gameTime=0,this.canShoot=!0,this.shootPressed=!1,this.targetedShape=null}async init(){try{this.soundManager=new Wn,this.handTracker=new zn,await this.handTracker.init(),await this.handTracker.start(),this.renderer=new Ln(this.canvas),await this.renderer.init(),this.gameState=new In,this.shapeSpawner=new Dn(this.renderer),this.particleSystem=new Vn(this.renderer),this.setupEventListeners(),this.isInitialized=!0,this.currentGameState="ready",document.getElementById("status").classList.add("hidden"),this.music.volume=.2;try{await this.music.play()}catch{console.warn("Autoplay was blocked by the browser. Music will start on first user interaction.")}requestAnimationFrame(()=>this.gameLoop())}catch(o){console.error("Initialization error:",o),document.getElementById("status").textContent=`Error: ${o.message}`}}setupEventListeners(){document.getElementById("startBtn").addEventListener("click",()=>this.startGame()),document.getElementById("restartBtn").addEventListener("click",()=>this.restartGame());const o=d=>{(d.type!=="keydown"||!d.repeat)&&(this.shootPressed=!0)},l=()=>{this.shootPressed=!1};window.addEventListener("mousedown",o),window.addEventListener("mouseup",l),window.addEventListener("touchstart",o,{passive:!1}),window.addEventListener("touchend",l),window.addEventListener("keydown",o),window.addEventListener("keyup",l)}startGame(){this.currentGameState==="ready"&&(document.body.classList.add("game-playing"),document.getElementById("startScreen").classList.add("hidden"),this.currentGameState="playing",this.gameState.reset(),this.shapeSpawner.reset(),this.particleSystem.reset(),this.gameTime=0,this.music.paused&&this.music.play())}restartGame(){document.body.classList.remove("game-playing"),document.getElementById("gameOver").classList.remove("show"),document.getElementById("startScreen").classList.remove("hidden"),this.currentGameState="ready"}gameLoop(){const o=performance.now(),l=(o-this.lastTime)/1e3;this.lastTime=o;const d=this.handTracker.getPointerPosition();this.updateUI(d),this.currentGameState==="playing"&&!this.gameState.isGameOver&&this.updateGame(l,d),this.renderer.render({shapes:this.shapeSpawner.getShapes(),particles:this.particleSystem.getParticles(),targetedShape:this.targetedShape}),requestAnimationFrame(()=>this.gameLoop())}updateUI(o){o&&(this.crosshair.style.left=`${o.x}px`,this.crosshair.style.top=`${o.y}px`,this.handIndicator.style.left=`${o.x}px`,this.handIndicator.style.top=`${o.y}px`),this.handTracker.isHandDetected()?(this.handStatus.textContent="HAND DETECTED",this.handStatus.classList.add("detected"),this.handStatus.classList.remove("not-detected")):(this.handStatus.textContent="HAND NOT DETECTED",this.handStatus.classList.add("not-detected"),this.handStatus.classList.remove("detected")),this.crosshair.classList.toggle("targeting",!!this.targetedShape),document.getElementById("score").textContent=this.gameState.score,document.getElementById("wave").textContent=this.gameState.wave,document.getElementById("shapeCount").textContent=this.shapeSpawner.getShapes().length}updateGame(o,l){this.gameTime+=o,this.shapeSpawner.update(o,this.gameTime),this.particleSystem.update(o);const d=this.shapeSpawner.getShapes();this.targetedShape=this.performRaycast(l,d),this.shootPressed&&this.canShoot&&this.targetedShape&&(this.destroyShape(this.targetedShape),this.gameState.addScore(100),this.soundManager.playShootSound(),this.canShoot=!1,this.targetedShape=null),this.shootPressed||(this.canShoot=!0);for(const h of d)if(!h.toBeRemoved&&(h.position[0]+=h.velocity[0]*o,h.position[1]+=h.velocity[1]*o,h.position[2]+=h.velocity[2]*o,h.rotationX+=o*.5,h.rotationY+=o*.3,h.threat=Math.max(0,Math.min(1,(h.position[2]+10)/14.5)),h.position[2]>4.5)){this.gameOver();break}}destroyShape(o){o.toBeRemoved||(this.particleSystem.createExplosion(o.position,o.color),o.toBeRemoved=!0)}performRaycast(o,l){if(!o)return null;const d=40;let h=null,v=d;for(const S of l){if(S.toBeRemoved)continue;const g=this.renderer.projectToScreen(S.position);if(g){const A=Math.hypot(g.x-o.x,g.y-o.y);A<v&&(v=A,h=S)}}return h}gameOver(){document.body.classList.remove("game-playing"),this.gameState.isGameOver=!0,this.currentGameState="gameOver",document.getElementById("finalScore").textContent=this.gameState.score,document.getElementById("gameOver").classList.add("show")}}new Xn().init();
//# sourceMappingURL=index-qmMyTS-s.js.map
